<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estratégia Penny Product: Modelo (Origem x Exposição)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet" />

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            brand: {
              bg: '#070A12',
              panel: '#0B1220',
              panel2: '#0E1A2B',
              border: 'rgba(148,163,184,0.14)',
              text: '#E5E7EB',
              muted: 'rgba(229,231,235,0.70)',
              accent: '#22c55e',
              accent2: '#60a5fa',
              warn: '#f59e0b',
              danger: '#ef4444'
            }
          },
          boxShadow: {
            soft: '0 10px 30px rgba(0,0,0,0.35)'
          }
        }
      }
    }
  </script>

  <style>
    .mono { font-variant-numeric: tabular-nums; }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
  </style>
</head>

<body class="bg-brand-bg text-brand-text font-sans">
  <header class="max-w-7xl mx-auto px-6 pt-10 pb-6">
    <div class="flex flex-col gap-2">
      <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">
        Penny Product — Modelo (Origem × Exposição)
      </h1>
      <p class="text-brand-muted max-w-3xl">
        Separação explícita entre <span class="text-white font-semibold">origem (custo de mídia)</span> e
        <span class="text-white font-semibold">exposição (quem recebe a oferta)</span> para evitar
        superestimação de receita e subestimação de CAC.
      </p>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 pb-16">
    <div class="grid lg:grid-cols-12 gap-6">
      <!-- Inputs -->
      <section class="lg:col-span-4">
        <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5">
          <div class="flex items-center justify-between">
            <h2 class="text-lg font-bold">Inputs do Modelo</h2>
            <button id="btnReset" class="text-sm px-3 py-1.5 rounded-xl border border-brand-border hover:bg-white/5 transition">
              Reset
            </button>
          </div>

          <div class="mt-4 space-y-5">
            <!-- Base -->
            <div class="bg-brand-panel2 border border-brand-border rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Base & Exposição</h3>
                <span class="text-xs text-brand-muted">escopo</span>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-xs text-brand-muted">Base total (inscritos)</span>
                  <input id="B" type="number" min="0" step="1"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="87000" />
                </label>

                <label class="block">
                  <span class="text-xs text-brand-muted">% base que recebe a oferta</span>
                  <input id="E" type="number" min="0" max="100" step="1"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="50" />
                </label>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Base exposta</div>
                  <div id="B_exp" class="mono text-lg font-bold mt-1">—</div>
                </div>
                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Base não exposta</div>
                  <div id="B_nexp" class="mono text-lg font-bold mt-1">—</div>
                </div>
              </div>
            </div>

            <!-- Mídia -->
            <div class="bg-brand-panel2 border border-brand-border rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Origem & Mídia</h3>
                <span class="text-xs text-brand-muted">custo</span>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-xs text-brand-muted">% share mídia paga</span>
                  <input id="S" type="number" min="0" max="100" step="1"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="60" />
                </label>

                <label class="block">
                  <span class="text-xs text-brand-muted">CPL médio (R$)</span>
                  <input id="CPL" type="number" min="0" step="0.01"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="8" />
                  <div class="mt-2 text-xs text-brand-muted">
                    Custo total de mídia:
                    <span id="Cost_media" class="mono font-semibold text-white">—</span>
                  </div>
                </label>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Inscritos pagos</div>
                  <div id="B_paid" class="mono text-lg font-bold mt-1">—</div>
                </div>
                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Inscritos orgânicos</div>
                  <div id="B_org" class="mono text-lg font-bold mt-1">—</div>
                </div>
              </div>
            </div>

            <!-- Penny -->
            <div class="bg-brand-panel2 border border-brand-border rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Penny (L1)</h3>
                <span class="text-xs text-brand-muted">receita imediata</span>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-xs text-brand-muted">Conv. penny (sobre expostos) %</span>
                  <input id="p_penny" type="number" min="0" max="100" step="0.1"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="6" />
                </label>

                <label class="block">
                  <span class="text-xs text-brand-muted">Split R$5 (% dos penny)</span>
                  <input id="s5" type="number" min="0" max="100" step="1"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="70" />
                </label>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Compradores penny</div>
                  <div id="N_penny" class="mono text-lg font-bold mt-1">—</div>
                  <div class="text-xs text-brand-muted mt-1">R$5: <span id="N_5" class="mono text-white font-semibold">—</span> • R$17: <span id="N_17" class="mono text-white font-semibold">—</span></div>
                </div>
                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Receita penny</div>
                  <div id="Rev_penny" class="mono text-lg font-bold mt-1">—</div>
                  <div class="text-xs text-brand-muted mt-1">Ticket médio penny: <span id="ARPP_penny" class="mono text-white font-semibold">—</span></div>
                </div>
              </div>
            </div>

            <!-- Full -->
            <div class="bg-brand-panel2 border border-brand-border rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Full (L2)</h3>
                <span class="text-xs text-brand-muted">qualificação</span>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-xs text-brand-muted">Conv. full controle %</span>
                  <input id="p_full_ctrl" type="number" min="0" max="100" step="0.01"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="0.66" />
                </label>

                <label class="block">
                  <span class="text-xs text-brand-muted">Uplift comprador→full (x)</span>
                  <input id="U" type="number" min="1" step="0.01"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="2.0" />
                </label>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-xs text-brand-muted">Canibalização no exposto (%)</span>
                  <input id="k" type="number" min="0" max="100" step="1"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="10" />
                </label>

                <label class="block">
                  <span class="text-xs text-brand-muted">Ticket Full (R$)</span>
                  <input id="P_full" type="number" min="0" step="1"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="1200" />
                </label>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Full incremental (penny)</div>
                  <div id="N_full_incr" class="mono text-lg font-bold mt-1">—</div>
                  <div class="text-xs text-brand-muted mt-1">Full base exposto: <span id="N_full_exp_base" class="mono text-white font-semibold">—</span></div>
                </div>
                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Full total</div>
                  <div id="N_full_total" class="mono text-lg font-bold mt-1">—</div>
                  <div class="text-xs text-brand-muted mt-1">Receita full: <span id="Rev_full" class="mono text-white font-semibold">—</span></div>
                </div>
              </div>
            </div>

            <!-- Custos -->
            <div class="bg-brand-panel2 border border-brand-border rounded-2xl p-4">
              <div class="flex items-center justify-between">
                <h3 class="font-semibold">Custos (L3)</h3>
                <span class="text-xs text-brand-muted">eficiência</span>
              </div>

              <div class="mt-3 grid grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-xs text-brand-muted">Custo fixo operacional (R$)</span>
                  <input id="F" type="number" min="0" step="100"
                         class="mt-1 w-full rounded-xl bg-black/20 border border-brand-border px-3 py-2 outline-none focus:ring-2 focus:ring-white/10"
                         value="25000" />
                </label>

                <div class="rounded-xl bg-black/20 border border-brand-border p-3">
                  <div class="text-xs text-brand-muted">Custo total (mídia + fixo)</div>
                  <div id="Cost_total" class="mono text-lg font-bold mt-1">—</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Outputs -->
      <section class="lg:col-span-8">
        <div class="grid sm:grid-cols-2 xl:grid-cols-4 gap-6">
          <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5">
            <div class="text-xs text-brand-muted">Receita Total</div>
            <div id="Rev_total" class="mono text-2xl font-extrabold mt-2">—</div>
            <div class="text-xs text-brand-muted mt-2">Penny + Full</div>
          </div>

          <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5">
            <div class="text-xs text-brand-muted">CAC Full</div>
            <div id="CAC_full" class="mono text-2xl font-extrabold mt-2">—</div>
            <div class="text-xs text-brand-muted mt-2">Cost_total / Full_total</div>
          </div>

          <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5">
            <div class="text-xs text-brand-muted">RPL (Receita por inscrito)</div>
            <div id="RPL" class="mono text-2xl font-extrabold mt-2">—</div>
            <div class="text-xs text-brand-muted mt-2">Rev_total / Base_total</div>
          </div>

          <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5">
            <div class="text-xs text-brand-muted">RPL Líquido</div>
            <div id="RPL_net" class="mono text-2xl font-extrabold mt-2">—</div>
            <div class="text-xs text-brand-muted mt-2">(Rev_total - Cost_total) / Base</div>
          </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-6 mt-6">
          <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5">
            <div class="flex items-center justify-between">
              <h3 class="font-bold">Receita (Penny vs Full)</h3>
              <span class="text-xs text-brand-muted">R$</span>
            </div>
            <div class="mt-4">
              <canvas id="chartRevenue" height="140"></canvas>
            </div>
          </div>

          <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5">
            <div class="flex items-center justify-between">
              <h3 class="font-bold">Custos (Mídia vs Fixo)</h3>
              <span class="text-xs text-brand-muted">R$</span>
            </div>
            <div class="mt-4">
              <canvas id="chartCosts" height="140"></canvas>
            </div>
          </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-6 mt-6">
          <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5 lg:col-span-2">
            <div class="flex items-center justify-between">
              <h3 class="font-bold">Volume (Base → Penny → Full)</h3>
              <span class="text-xs text-brand-muted">pessoas</span>
            </div>
            <div class="mt-4">
              <canvas id="chartFunnel" height="140"></canvas>
            </div>
          </div>

          <div class="bg-brand-panel border border-brand-border rounded-2xl shadow-soft p-5">
            <div class="text-xs text-brand-muted">Notas de leitura</div>
            <ul class="mt-3 text-sm text-brand-muted space-y-2">
              <li>• <span class="text-white font-semibold">Custo de mídia</span> depende apenas de <span class="text-white font-semibold">share pago</span> e <span class="text-white font-semibold">CPL</span>.</li>
              <li>• <span class="text-white font-semibold">Penny</span> só existe na <span class="text-white font-semibold">base exposta</span>.</li>
              <li>• <span class="text-white font-semibold">Uplift</span> afeta apenas quem <span class="text-white font-semibold">comprou penny</span>.</li>
              <li>• Canibalização reduz o <span class="text-white font-semibold">full base</span> no grupo exposto.</li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // ---------- Helpers ----------
    const brl = (v) => {
      const n = Number.isFinite(v) ? v : 0;
      return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 });
    };
    const brl2 = (v) => {
      const n = Number.isFinite(v) ? v : 0;
      return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2, maximumFractionDigits: 2 });
    };
    const intfmt = (v) => (Number.isFinite(v) ? Math.round(v).toLocaleString('pt-BR') : '0');
    const pctToUnit = (p) => Math.max(0, Math.min(1, (Number(p) || 0) / 100));

    const $ = (id) => document.getElementById(id);

    function readInputs() {
      const B = Math.max(0, Number($('B').value) || 0);

      const E = pctToUnit($('E').value);
      const S = pctToUnit($('S').value);

      const CPL = Math.max(0, Number($('CPL').value) || 0);
      const F = Math.max(0, Number($('F').value) || 0);

      const p_penny = pctToUnit($('p_penny').value);
      const s5 = pctToUnit($('s5').value);

      const p_full_ctrl = pctToUnit($('p_full_ctrl').value);
      const U = Math.max(1, Number($('U').value) || 1);

      const k = pctToUnit($('k').value);
      const P_full = Math.max(0, Number($('P_full').value) || 0);

      return { B, E, S, CPL, F, p_penny, s5, p_full_ctrl, U, k, P_full };
    }

    function computeModel(inp) {
      const { B, E, S, CPL, F, p_penny, s5, p_full_ctrl, U, k, P_full } = inp;

      // Origem (Custo)
      const B_paid = B * S;
      const B_org = B - B_paid;
      const Cost_media = B_paid * CPL;
      const Cost_total = Cost_media + F;

      // Exposição (Receita)
      const B_exp = B * E;
      const B_nexp = B - B_exp;

      // Penny (L1)
      const N_penny = B_exp * p_penny;
      const N_5 = N_penny * s5;
      const N_17 = N_penny * (1 - s5);
      const Rev_penny = (N_5 * 5) + (N_17 * 17);
      const ARPP_penny = N_penny > 0 ? (Rev_penny / N_penny) : 0;

      // Full (L2)
      const N_full_nexp = B_nexp * p_full_ctrl;

      const p_full_exp_base = p_full_ctrl * (1 - k);
      const N_full_exp_base = B_exp * p_full_exp_base;

      // incremental: compradores do penny têm propensão maior
      const p_incr = p_full_ctrl * (U - 1);
      const N_full_incr = N_penny * p_incr;

      const N_full_total = N_full_nexp + N_full_exp_base + N_full_incr;
      const Rev_full = N_full_total * P_full;

      // Totais
      const Rev_total = Rev_penny + Rev_full;

      // Eficiência (L3)
      const CAC_full = N_full_total > 0 ? (Cost_total / N_full_total) : 0;
      const RPL = B > 0 ? (Rev_total / B) : 0;
      const RPL_net = B > 0 ? ((Rev_total - Cost_total) / B) : 0;

      return {
        B_paid, B_org, Cost_media, Cost_total,
        B_exp, B_nexp,
        N_penny, N_5, N_17, Rev_penny, ARPP_penny,
        N_full_nexp, N_full_exp_base, N_full_incr, N_full_total, Rev_full,
        Rev_total, CAC_full, RPL, RPL_net
      };
    }

    // ---------- Charts ----------
    let chartRevenue, chartCosts, chartFunnel;

    function makeChart(ctx, cfg) {
      return new Chart(ctx, cfg);
    }

    function initCharts() {
      const ctxRev = $('chartRevenue').getContext('2d');
      const ctxCost = $('chartCosts').getContext('2d');
      const ctxFun = $('chartFunnel').getContext('2d');

      chartRevenue = makeChart(ctxRev, {
        type: 'bar',
        data: {
          labels: ['Penny', 'Full'],
          datasets: [{
            label: 'Receita',
            data: [0, 0],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: { label: (c) => brl(c.parsed.y) }
            }
          },
          scales: {
            y: {
              ticks: {
                callback: (v) => (Number(v) || 0).toLocaleString('pt-BR')
              }
            }
          }
        }
      });

      chartCosts = makeChart(ctxCost, {
        type: 'bar',
        data: {
          labels: ['Mídia', 'Fixo'],
          datasets: [{
            label: 'Custos',
            data: [0, 0],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: { label: (c) => brl(c.parsed.y) }
            }
          },
          scales: {
            y: {
              ticks: {
                callback: (v) => (Number(v) || 0).toLocaleString('pt-BR')
              }
            }
          }
        }
      });

      chartFunnel = makeChart(ctxFun, {
        type: 'bar',
        data: {
          labels: ['Base total', 'Base exposta', 'Penny', 'Full total'],
          datasets: [{
            label: 'Volume',
            data: [0, 0, 0, 0],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: { label: (c) => intfmt(c.parsed.y) + ' pessoas' }
            }
          },
          scales: {
            y: {
              ticks: { callback: (v) => (Number(v) || 0).toLocaleString('pt-BR') }
            }
          }
        }
      });
    }

    // ---------- Render ----------
    function render() {
      const inp = readInputs();
      const out = computeModel(inp);

      // Base & Exposição
      $('B_exp').textContent = intfmt(out.B_exp);
      $('B_nexp').textContent = intfmt(out.B_nexp);

      // Origem & Mídia
      $('B_paid').textContent = intfmt(out.B_paid);
      $('B_org').textContent = intfmt(out.B_org);
      $('Cost_media').textContent = brl(out.Cost_media);
      $('Cost_total').textContent = brl(out.Cost_total);

      // Penny
      $('N_penny').textContent = intfmt(out.N_penny);
      $('N_5').textContent = intfmt(out.N_5);
      $('N_17').textContent = intfmt(out.N_17);
      $('Rev_penny').textContent = brl(out.Rev_penny);
      $('ARPP_penny').textContent = brl2(out.ARPP_penny);

      // Full
      $('N_full_incr').textContent = intfmt(out.N_full_incr);
      $('N_full_exp_base').textContent = intfmt(out.N_full_exp_base);
      $('N_full_total').textContent = intfmt(out.N_full_total);
      $('Rev_full').textContent = brl(out.Rev_full);

      // Top cards
      $('Rev_total').textContent = brl(out.Rev_total);
      $('CAC_full').textContent = brl2(out.CAC_full);
      $('RPL').textContent = brl2(out.RPL);
      $('RPL_net').textContent = brl2(out.RPL_net);

      // Charts
      if (chartRevenue) {
        chartRevenue.data.datasets[0].data = [out.Rev_penny, out.Rev_full];
        chartRevenue.update();
      }
      if (chartCosts) {
        chartCosts.data.datasets[0].data = [out.Cost_media, inp.F];
        chartCosts.update();
      }
      if (chartFunnel) {
        chartFunnel.data.datasets[0].data = [inp.B, out.B_exp, out.N_penny, out.N_full_total];
        chartFunnel.update();
      }
    }

    function bind() {
      const ids = ['B','E','S','CPL','F','p_penny','s5','p_full_ctrl','U','k','P_full'];
      ids.forEach(id => $(id).addEventListener('input', render));

      $('btnReset').addEventListener('click', () => {
        $('B').value = 87000;
        $('E').value = 50;
        $('S').value = 60;
        $('CPL').value = 8;
        $('F').value = 25000;
        $('p_penny').value = 6;
        $('s5').value = 70;
        $('p_full_ctrl').value = 0.66;
        $('U').value = 2.0;
        $('k').value = 10;
        $('P_full').value = 1200;
        render();
      });
    }

    // Boot
    initCharts();
    bind();
    render();
  </script>
</body>
</html>
